<!DOCTYPE html>
<html>
<head>
    <title>Draw 3d</title>
    <style>
        .log{
            background-color: #999999;
        }
    </style>
    <script type="text/javascript" src="js/view/View.class.js"></script>
    <script type="text/javascript" src="js/view/VerticalLayout.class.js"></script>
    <script type="text/javascript" src="js/view/Button.class.js"></script>
    <script type="text/javascript" src="js/view/ListItem.class.js"></script>

    <script type="text/javascript" src="js/RayTrace/Vector.class.js"></script>
    <script type="text/javascript" src="js/RayTrace/Color.class.js"></script>
    <script type="text/javascript" src="js/RayTrace/Plane.class.js"></script>
    <script type="text/javascript" src="js/RayTrace/Surfaces.class.js"></script>
    <script type="text/javascript" src="js/RayTrace/Sphere.class.js"></script>
    <script type="text/javascript" src="js/RayTrace/Camera.class.js"></script>
    <script type="text/javascript" src="js/RayTrace/Raytracer.class.js"></script>

    <script type="text/javascript" src="js/Conditional.class.js"></script>
    <script type="text/javascript" src="js/Queue.object.js"></script>

    <script type="text/javascript">
        var buildProperty=function(context,name,setter,getter){
            var f=function(value){if(value==undefined){return context[name];}else{context[name]=value;return context;}}
            f.bind(context);
            return f;
        }

    </script>
    <script type="text/javascript">
        function defaultScene() {
            return {
                things: [
                    new Plane(new Vector(0.0, 1.0, 0.0), 0.0, Surfaces.checkerboard),
                    new Plane(new Vector(1.0, 0.0, 0.0), 4.0, Surfaces.diffuse),
                    new Sphere(new Vector(0.0, 1.0, -0.25), 1.0, Surfaces.shiny),
                    new Sphere(new Vector(-1.0, 0.5, 1.5), 0.5, Surfaces.shiny)
                ],
                lights: [
                    {
                        pos: new Vector(-2.0, 2.5, 0.0),
                        color: new Color(0.1, 0.31, 0)
                    },
                    {
                        pos: new Vector(1.5, 2.5, 1.5),
                        color: new Color(0.1, 0.21, 0.1)
                    },
                    {
                        pos: new Vector(1.5, 2.5, -1.5),
                        color: new Color(0.21, 0.21, 0.1)
                    },
                    {
                        pos: new Vector(0.0, 3.5, 0.0),
                        color: new Color(1, 1, 1)
                    }
                ],
                camera: new Camera(new Vector(6.0, 4.0, 8.0), new Vector(-4.0, -2.0, -2.0))
            };
        }

        function initInterface(){
            var b=new Button('start render',function(event){exec(512,300)});
            b.bindToParent(document.body);
            var e=new Button('feedback',function(owner,data,event){console.log(owner,owner.getTitle(),event)});
            dialog={
                log:function(s){
                    e.setTitle(s);
                }
            }
            e.bindToParent(document.body);
            li1=new ListItem('set Show Date',ListItem.decorations.arrow);
            li1.setClickListener(function(owner,data,event){
                While(function(){return true}).Do(function(owner,data,event){;li1.setText(Date().toString())});
            })
            li2=new ListItem('start showing date',ListItem.decorations.next);
            li2.setClickListener(function(owner,data,event){
                Queue.Resume();
            })
            li3=new ListItem('pause queue',ListItem.decorations.none);
            li3.setClickListener(function(owner,data,event){
                Queue.Pause();
            })
            li1.bindToParent(document.body);
            li2.bindToParent(document.body);
            li3.bindToParent(document.body);
        }
        
        function exec(rezx,rezy) {
            var canv = document.createElement("canvas");
            canv.id='render';
            canv.width = rezx;
            canv.height = rezy;
            document.body.appendChild(canv);
            var ctx = canv.getContext("2d");
            var rayTracer = new RayTracer();
            dialog.total=rezx*rezy*5;
            console.log('begin');
            rayTracer.render(defaultScene(), ctx, rezx, rezx,32,0,dialog);
        }
    </script>
</head>
<body style="background:url(js/view/templates-images/backgroundStripes.png);" onload="initInterface()">
</body>
</html>